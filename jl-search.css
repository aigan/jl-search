jl-search {
  display: inline-block;
  font-family: var(--font-family, sans-serif);
  --_padding: var(--padding, .5em);
  --_enabled-color: var(--outline-color, gray );
  --_hover-color: var(--hover-color, black );
  --_active-color: var(--active-color, orange );
  --_focus-color: var(--focus-color, green);
  --_focus-bg: var(--focus-bg, lightgray);
  --_disabled-color: var(--disabled-color, silver);
	--_input-bg:  var(--input-bg);
  --_input-ink: var(--input-ink);
  --_disabled_content_opacity: var(--disabled-opacity, .38);
  --_border-width: var(--border-width, .15rem);
  --_border-width-focus: var(--border-width-focus, .25rem);
  --_border-radius: var(--border-radius, .35rem);
  --_hr-color: var(--hr-background, silver);
  --_shadow-color: var(--shadow-color, black);
  --_drop-shadow: 0 .8rem 1rem 0 rgba(0 0 0 / .5);
  --_outline-color: var(--_enabled-color);
  --_error-ink: var(--error-ink, red);
  --_error-container-bg: var(--error-container-bg, lightsalmon);
  --_error-container-ink: var(--error-container-ink, maroon);

}


jl-search>.input-wrapper> span{
  flex: 0 0 auto;
}

jl-search input {
  /* padding: 0; */
  padding: var(--_padding);

  margin: 0;
  border: none;
  outline: none;
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
  color: inherit;
  background-color: transparent;

  /* flex: 1 1 2em; */
  width: 100%;
}

jl-search input:focus,
jl-search input:focus-within {
  outline: none;
  border: none;
}

jl-search:hover {
  --_outline-color: var(--_hover-color);
}

jl-search:hover:active {
  --_outline-color: var(--_active-color);
}

jl-search>.input-wrapper {

  display: flex;
  align-items: center;
  gap: var(--_padding);

  border-radius: var(--_border-radius);

  /* padding: var(--_padding); */

  background: var(--_input-bg);
  color: var(--_input-ink);
  transition: box-shadow .2s;

  /* Using outline for stable position when outline width changes */
  outline: var(--_border-width) solid var(--_outline-color);
}

jl-search>.input-wrapper>.state:hover {
  background: var(--_focus-bg);
}

jl-search:focus-within {
  --_outline-color: var(--_focus-color);
}

jl-search>.input-wrapper:focus-within {
  outline-width: var(--_border-width-focus);
}

jl-search:has(input:disabled,input:active:disabled) {
  opacity: var(--_disabled_content_opacity);
  --_outline-color: var(--_disabled-color);
}

jl-search[opened] > .input-wrapper {
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
  outline-width: var(--_border-width-focus);

  box-shadow: var(--_drop-shadow);
}


jl-search .options {
  border-radius: var(--_border-radius);
  border-top-right-radius: 0;
  border-top-left-radius: 0;

  /* First line paints over the top shadow. Adding 1px for rounding errors */
  box-shadow:
  0 calc( -1px - var(--_border-width-focus) ) 0 0 var(--_input-bg)
  , 0 0 0 var(--_border-width-focus) var(--_outline-color)
  , var(--_drop-shadow);

  border: 0;
  margin: 0;
  padding: 0;
  background: var(--_input-bg);

  box-sizing: border-box;
  position: absolute;
  top: anchor(bottom);
  left: anchor(left);
  width: anchor-size(width);
  overflow: hidden;
}

jl-search .options:not(.loaded-popover){
  visibility:hidden;
}


/* jl-search[opened] .options {
  visibility: visible;
} */

jl-search .options hr {
  border: thin solid var(--_hr-color);
  margin: 0 var(--_padding);
}

/* jl-search .options.empty ul { display: none } */
/* jl-search .options.empty ul { max-height:0em } */

jl-search .options.empty hr:has(+ul) { display: none }

jl-search .options hr:has(+.error) { display: none }
jl-search .options .error {
  /* margin: calc( 0px - var(--padding)); */
  
  background: var(--_error-container-bg);
  color: var(--_error-container-ink);
}

jl-search[data-state="loading"] .state {
  height: 1em;
}

jl-search[data-state="error"] .state {
  color: var(--_error-ink);
}

jl-search ul {
  list-style: none;
  margin: 0;
  padding: var(--_padding) 0;

  display: flex;
  flex-direction: column;
  gap: var(--padding);
  /* gap: calc( var(--padding) / 3 ); */
  line-height: 1;

  /* transition: height 2s;
  transition-behavior: allow-discrete; */

}

jl-search ul > li {
  /* padding: calc(var(--_padding)/3) var(--_padding) ; */
  padding: 0 var(--_padding) ;
}

/* 
li::view-transition-old(*){
  animation: 0.25s linear both shrink-y;
}
li::view-transition-new(*){
  animation: 0.25s linear both grow-y;
} */





jl-search ul > li:hover {
  background: var(--_focus-bg);
  cursor: pointer;
}

jl-search .feedback {
  font-size: .875em;
  padding: var(--_padding);

}

jl-search .spin {
  animation: spin 2s infinite linear;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(359deg);
  }
}

/* Zoom in in input on smaller screens */

@media (max-width: 25rem) {
  jl-search {
    view-transition-name: jl-search-field;
  }

  jl-search[opened] {
    position: absolute;
    top: var(--_border-width-focus);
    left: var(--_border-width-focus);
    width: calc(100% - 2 * var(--_border-width-focus) );
    z-index: 2;
  }
}

@keyframes grow-y {
  from { transform: scaleY(0) }
  to   { transform: scaleY(1) }
}

@keyframes shrink-y {
  from { transform: scaleY(1) }
  to   { transform: scaleY(0) }
}



/* back-compat */
[popover].\:popover-open {
  /* transform: scaleY(1); */
  max-height: 100svh;
} 
[popover]:popover-open {
  /* transform: scaleY(1); */
  max-height: 100svh;
}

[popover] {
  max-height: 0svh;
  /* transform: scaleY(0);
  transform-origin: top; */

  transition:
    /* transform .3s, */
    max-height .3s,
    overlay .3s allow-discrete,
    display .3s allow-discrete;
}

@starting-style {
  [popover]:popover-open {
    max-height: 0svh;
    /* transform: scaleY(0); */
  }

  /* jl-search .options li {
    height: 0rem;
  } */
}

/* jl-search .options li {
  height: 3rem;
  transition height 3s, overlay 3s allow-discrete, display 3s allow-discrete;

}
 */
